# 10장. 리액트 17과 18의 변경 사항 살펴보기
## 10.1 리액트 17버전 살펴보기

### 10.1.1 리액트의 점진적인 업그레이드 
1. 16 -> 17 버전으로 업그레이드 하기 쉽다. 호환성이 많이 안깨짐

### 10.1.2 이벤트 위임 방식의 변경
1. 리액트의 이벤트 핸들러. onClick으로 붙여보면 noop 이라는 게 있음. -> no operation. 
2. 이벤트 타입당 하나의 핸들러를 부착한다. 이벤트 위임. 이벤트 핸들러를 각 요소가 아닌 최상위에서 관리한다.
   1. 캡처: 트리 최상단요소에서 이벤트가 발생한 타깃까지 내려가는
   2. 타깃: 타깃 노드에 도달하는 단계. 여기서 이벤트 발생
   3. 버블링: 최상위까지 올라가는
3. 16과 17의 차이는 이벤트 위임이 document vs react root의 차이. 이유는 다른 모듈과의 충돌 방지. (e.stoppropagation 방지 등)
 
### 10.1.3 import react 필요없음. JSX transform
1. 바벨과 협력. import 안해도됨. react/jsx-runtime을 같이 불러오면서.

### 10.1.4 그 외
1. 이벤트 풀링: 비동기 코드 내에서 이벤트를 실행하면, 즉시 null로 변하기 때문에 에러가 발생한다. e.persist를 이용해 처리
2. useEffect의 클린업함수의 비동기 실행: 완전히 화면이 업데이트 후 ( 커밋이 끝난 후 ) 클린업 실행
3. undefined를 return하면 에러가 발생하도록 개선 

## 10.2 리액트 18버전 살펴보기
### 10.2.1 새로 추가된 훅
#### useId
1. 컴포넌트 별 유니크한 아이디 생성. 하이드레이션 시 불일치 문제를 해결할 수 있다.
2. 컴포넌트 인스턴스 마다 유니크한 값을 생성한다. 부모 트리 + 자신의 트리 위치 값
#### useTransition
1. UI 변경을 막지 않고 상태를 업데이트 하는 훅.
2. 긴급하지 않다고 판단, 무거운 훅들을 나중에 렌더링할 수 있다.
3. 동시성을 다룬다. 동기적으로 다음 컴포넌트를 기다리지 않고 로딩중임을 띄운다.

#### useDefferedValue
1. 바운스와 유사하다. 차이점은 하지만 시간을 지정하지 않음.
2. state 값을 감싸 렌더링을 지연시킨다.

#### useSyncExternalStore
1. useSubscription 대체. 동시성 지원을 안했다면 동기적으로 렌더링이 한 번에 일어나 테어링 X
2. 동시성이 가능해지며 이슈 발생. ( 최적화는 되어있음, but 외부 모듈 사용시 문제 )
3. 인수 3가지
   1. subscribe 함수. 스토어 변경 감지
   2. 스토어 값 비교. Object is 비교
   3. 서버 사이드 렌더링 시 하이드레이션

#### useInsertionEffect
1. css-in-js를 위한 라이브러리. script 태그에 미리 style을 넣어준다.
   
### 10.2.2 react-dom/client
1. createRoot: root create 과정. 배치 작업 연관
2. hydrateRoot: React로만 SSR 하려고 한다면

### 10.2.3 react-dom/sever 
#### renderToPipeableStream
1. 스트림을 이용해 리액트 컴포넌트를 HTML로
2. 점진적 렌더링, 중간에 script 삽입 가능
3. Suspense 사용할 수 있게 한다.
4. stream의 이미 처럼, 중간에 멈추고 다른 작업 후 이어서 전송한다.

#### renderToReadableStream
1. 웹 스트림 같은 모던 엣지 환경

### 10.2.4 자동 배치
1. 여러 상태 업데이트를 묶어서 리렌더링 한다.
2. 배치 수동으로 하는 법: flushSync
   
### 10.2.5 엄격 모드 
1. 잠재적인 버그 찾는다. 개발자 모드에서만 작동함.
2. 경고 리스트. 돔에 직접 접근하거나, 레거시 리액트의 경우.. 경고한다.
   1. 과거 생명주기 사용 시 알림
   2. 문자열 refs 사용 금지
   3. findDOMNode... 등등

#### 리액트 18의 엄격 모드
1. 언마운트 되더라도 이전의 state 기억한다. 앞/뒤 페이지 이동시. 유용하지만 부작용 있을 수 있으니 clean up 하자

### 10.2.6 Suspense 기능 강화
1. React.lazy와 Suspense. lazy로 지연시키고, Suspense를 이용해 fallback 처리한다.
2. 몇가지 이슈들 해소 
   1. 컴포넌트가 lazy -> useEffect가 발생할 수 있는 이슈 -> 해소
   2. 서버에선 사용할 수 없는 구조 -> 가능
   3. 자주 업데이트 되는 걸 막기 위한 스로틀링 기능 추가
